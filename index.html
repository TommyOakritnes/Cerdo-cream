<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Cerdo & Bellotas ‚Äî Arte Mejorado üê∑</title>
<meta name="theme-color" content="#0f1020"/>
<style>
  :root{
    --bg:#0e1020; --bg2:#13162a; --line:#2a3150; --txt:#eaf0ff; --muted:#b9bde6;
  }
  *{box-sizing:border-box} html,body{height:100%;margin:0}
  body{font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:var(--txt);
       background: radial-gradient(1200px 800px at 50% -20%, var(--bg2), var(--bg));}
  .wrap{max-width:960px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:12px}
  header{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;
         background:linear-gradient(180deg,#1a1f34,#151a2b); border:1px solid var(--line); border-radius:14px; padding:10px 12px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .btn{appearance:none;border:1px solid var(--line); background:#1a1f34; color:var(--txt);
       padding:9px 12px;border-radius:12px; cursor:pointer; transition:transform .12s ease}
  .btn:active{transform:translateY(1px)}
  .badge{padding:6px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted)}
  .score{font-variant-numeric: tabular-nums}
  .stage{position:relative;border:1px solid var(--line);border-radius:16px;overflow:hidden}
  canvas{display:block;width:100%;height:auto;touch-action:none;image-rendering:pixelated}
  .muted{color:var(--muted);text-align:center}
  /* Pad */
  .pad{display:grid;grid-template-columns:68px 68px 68px;grid-template-rows:68px 68px 68px;gap:10px;justify-content:center}
  .pbtn{background:#1a1f34;border:1px solid var(--line);border-radius:14px;color:#dde3ff;font-size:20px;display:flex;align-items:center;justify-content:center}
  .pbtn:active{transform:scale(.98)}
  .empty{background:transparent;border:none}
  @media (max-width:560px){ .pad{grid-template-columns:56px 56px 56px;grid-template-rows:56px 56px 56px} }
  @keyframes pop{0%{transform:scale(.9)}60%{transform:scale(1.04)}100%{transform:scale(1)}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>üê∑ <strong>Cerdo & Bellotas ‚Äî Arte Mejorado</strong></div>
    <div class="row">
      <button id="play" class="btn">‚ñ∂Ô∏è Jugar / Reiniciar</button>
      <button id="pause" class="btn">‚è∏Ô∏è Pausa</button>
      <button id="sound" class="btn">üîä Sonido</button>
      <button id="wrapBtn" class="btn">üîÅ Wrap: ON</button>
      <button id="share" class="btn">üîó Compartir</button>
      <span class="badge">Puntos: <b id="score" class="score">0</b></span>
      <span class="badge">R√©cord: <b id="best" class="score">0</b></span>
    </div>
  </header>

  <div class="stage">
    <canvas id="game" width="700" height="700"></canvas>
  </div>

  <div class="pad" aria-label="Controles t√°ctiles">
    <div class="empty"></div><button class="pbtn" id="up">‚ñ≤</button><div class="empty"></div>
    <button class="pbtn" id="left">‚óÄ</button><div class="empty"></div><button class="pbtn" id="right">‚ñ∂</button>
    <div class="empty"></div><button class="pbtn" id="down">‚ñº</button><div class="empty"></div>
  </div>

  <p class="muted">Arte nuevo: cerdo con orejas/cola y brillo, bellotas ilustradas, fondo con colinas y estrellas. Controles: Flechas/WASD, D-Pad y swipe. Sonido ‚Äúoing‚Äù, pausa, wrap y r√©cord.</p>
</div>

<script>
(()=>{
  // ===== Sprites SVG embebidos (data URL) =====
  const PIG_SVG = encodeURIComponent(`
  <svg xmlns='http://www.w3.org/2000/svg' width='128' height='128' viewBox='0 0 128 128'>
    <defs>
      <radialGradient id='g' cx='40%' cy='35%' r='70%'>
        <stop offset='0%' stop-color='#ffc9d7'/>
        <stop offset='100%' stop-color='#ff94ad'/>
      </radialGradient>
    </defs>
    <!-- orejas -->
    <ellipse cx='38' cy='38' rx='16' ry='12' fill='url(#g)'/>
    <ellipse cx='90' cy='38' rx='16' ry='12' fill='url(#g)'/>
    <!-- cuerpo/cabeza -->
    <circle cx='64' cy='64' r='40' fill='url(#g)'/>
    <!-- hocico -->
    <ellipse cx='80' cy='64' rx='18' ry='14' fill='#ffb7c6'/>
    <circle cx='74' cy='64' r='3.5' fill='#7a3b4d'/>
    <circle cx='86' cy='64' r='3.5' fill='#7a3b4d'/>
    <!-- ojos -->
    <circle cx='50' cy='56' r='4' fill='#2a2230'/>
    <circle cx='60' cy='68' r='4' fill='#2a2230'/>
    <!-- brillito -->
    <circle cx='48' cy='46' r='6' fill='rgba(255,255,255,.35)'/>
    <!-- cola -->
    <path d='M26 78 q-16 4 -8 12 q10 10 20 0' stroke='#ff86a4' stroke-width='5' fill='none' stroke-linecap='round'/>
  </svg>`);

  const ACORN_SVG = encodeURIComponent(`
  <svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'>
    <defs>
      <radialGradient id='ga' cx='50%' cy='40%' r='60%'>
        <stop offset='0%' stop-color='#b9783d'/>
        <stop offset='100%' stop-color='#8b5a2b'/>
      </radialGradient>
    </defs>
    <ellipse cx='32' cy='36' rx='20' ry='18' fill='url(#ga)'/>
    <ellipse cx='32' cy='24' rx='24' ry='12' fill='#5b3a1a'/>
    <path d='M32 11 q8 -6 4 -10' stroke='#5b3a1a' stroke-width='4' fill='none'/>
  </svg>`);

  const pigImg = new Image(); pigImg.src = 'data:image/svg+xml;utf8,'+PIG_SVG;
  const acornImg = new Image(); acornImg.src = 'data:image/svg+xml;utf8,'+ACORN_SVG;

  // ===== DOM & estado =====
  const cv=document.getElementById('game'), ctx=cv.getContext('2d');
  const playBtn=document.getElementById('play'), pauseBtn=document.getElementById('pause');
  const soundBtn=document.getElementById('sound'), wrapBtn=document.getElementById('wrapBtn'), shareBtn=document.getElementById('share');
  const scoreEl=document.getElementById('score'), bestEl=document.getElementById('best');
  const up=document.getElementById('up'),down=document.getElementById('down'),left=document.getElementById('left'),right=document.getElementById('right');

  const COLS=28, ROWS=28; let CELL=24;
  const SPEED0=115, SPEED_MIN=65, SPEED_STEP=2;

  let snake, dir, nextDir, acorn, score, tick, fat, grow, parts=[];
  let running=false, paused=false, last=0, acc=0, wrap=true;
  let audioOn=true, actx=null, best=+localStorage.getItem('cerdo_best')||0; bestEl.textContent=best;

  // ===== Utils =====
  const R=(n)=>Math.floor(Math.random()*n);
  const eq=(a,b)=>a.x===b.x&&a.y===b.y;
  const free=(occ)=>{for(;;){const p={x:R(COLS),y:R(ROWS)}; if(!occ.some(s=>eq(s,p))) return p;}};

  // ===== Responsive canvas & fondo con colinas =====
  function resize(){
    const maxSide=Math.min(window.innerWidth-24, 760);
    const size=Math.max(360, Math.min(maxSide, window.innerHeight-320));
    CELL=Math.max(16, Math.floor(size/Math.max(COLS,ROWS)));
    cv.width=CELL*COLS; cv.height=CELL*ROWS; draw();
  } window.addEventListener('resize', resize);

  function drawBackground(){
    // cielo
    const g=ctx.createLinearGradient(0,0,0,cv.height);
    g.addColorStop(0,'#161a33'); g.addColorStop(1,'#0f1124');
    ctx.fillStyle=g; ctx.fillRect(0,0,cv.width,cv.height);
    // estrellas
    ctx.fillStyle='rgba(255,255,255,.25)';
    for(let i=0;i<50;i++){ const x=R(cv.width), y=R(cv.height*0.5); ctx.fillRect(x,y,1,1); }
    // colinas
    ctx.fillStyle='#0c1322'; ctx.beginPath();
    ctx.moveTo(0, cv.height*0.75);
    for(let x=0;x<=cv.width;x+=40){
      const y= cv.height*0.75 + Math.sin(x*0.01)*12 + Math.cos(x*0.03)*6;
      ctx.lineTo(x,y);
    }
    ctx.lineTo(cv.width, cv.height); ctx.lineTo(0, cv.height); ctx.closePath(); ctx.fill();
    ctx.strokeStyle='#1e2748'; ctx.lineWidth=1; ctx.stroke();
    // rejilla sutil
    ctx.strokeStyle='#1c233f'; ctx.lineWidth=1;
    for(let i=0;i<=COLS;i++){ ctx.beginPath(); ctx.moveTo(i*CELL+.5,0); ctx.lineTo(i*CELL+.5,ROWS*CELL); ctx.stroke(); }
    for(let j=0;j<=ROWS;j++){ ctx.beginPath(); ctx.moveTo(0,j*CELL+.5); ctx.lineTo(COLS*CELL,j*CELL+.5); ctx.stroke(); }
  }

  // ===== Audio =====
  function ensureAudio(){ if(!actx) actx=new (window.AudioContext||window.webkitAudioContext)(); }
  function oing(){
    if(!audioOn) return; try{
      ensureAudio(); const a=actx, d=.22, o1=a.createOscillator(), o2=a.createOscillator(), g=a.createGain();
      o1.type='square'; o2.type='sine'; const t=a.currentTime, T=t+d;
      o1.frequency.setValueAtTime(180,t); o1.frequency.exponentialRampToValueAtTime(70,T);
      o2.frequency.setValueAtTime(240,t); o2.frequency.exponentialRampToValueAtTime(90,T);
      g.gain.setValueAtTime(.0001,t); g.gain.exponentialRampToValueAtTime(.38,t+.04); g.gain.exponentialRampToValueAtTime(.0001,T);
      o1.connect(g); o2.connect(g); g.connect(a.destination); o1.start(t); o2.start(t); o1.stop(T); o2.stop(T);
      if(navigator.vibrate) navigator.vibrate(20);
    }catch(e){}
  }

  // ===== Part√≠culas =====
  function burst(x,y){
    for(let i=0;i<12;i++){
      parts.push({x:x*CELL+CELL/2,y:y*CELL+CELL/2,vx:(Math.random()-0.5)*3,vy:(Math.random()-0.5)*3,r:Math.random()*3+1,a:1});
    }
  }
  function drawParts(){
    for(let i=parts.length-1;i>=0;i--){
      const p=parts[i]; p.x+=p.vx; p.y+=p.vy; p.a-=0.03;
      ctx.fillStyle=`rgba(255,111,146,${Math.max(0,p.a)})`;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
      if(p.a<=0) parts.splice(i,1);
    }
  }

  // ===== Dibujo sprites =====
  function drawPig(xc,yc,isHead,dir,scale=1){
    const px=xc*CELL, py=yc*CELL;
    const size = Math.floor(CELL*1.05*scale);
    const off = (CELL - size)/2;
    ctx.save();
    // sombrita
    ctx.fillStyle='rgba(0,0,0,.25)';
    ctx.beginPath(); ctx.ellipse(px+CELL/2, py+CELL/2+4, size*.45, size*.28, 0, 0, Math.PI*2); ctx.fill();
    // rotaci√≥n suave seg√∫n direcci√≥n
    const angle = dir.x? 0 : (dir.y>0? Math.PI/18 : -Math.PI/18);
    ctx.translate(px+off+size/2, py+off+size/2);
    ctx.rotate(angle);
    ctx.drawImage(pigImg, -size/2, -size/2, size, size);
    ctx.restore();
  }
  function drawAcorn(xc,yc){
    const px=xc*CELL, py=yc*CELL;
    const size = Math.floor(CELL*0.9);
    const off=(CELL-size)/2;
    ctx.drawImage(acornImg, px+off, py+off, size, size);
  }

  // ===== Juego =====
  function reset(){
    snake=[{x:Math.floor(COLS/2)-1,y:Math.floor(ROWS/2)},
           {x:Math.floor(COLS/2)-2,y:Math.floor(ROWS/2)},
           {x:Math.floor(COLS/2)-3,y:Math.floor(ROWS/2)}];
    dir={x:1,y:0}; nextDir={...dir}; score=0; scoreEl.textContent=score;
    tick=SPEED0; fat=0; grow=0; acorn=free(snake);
    running=true; paused=false; last=0; acc=0;
    draw();
  }
  function setPause(p){ paused=p; pauseBtn.textContent=p?'‚ñ∂Ô∏è Reanudar':'‚è∏Ô∏è Pausa'; }
  function step(){
    if(Math.abs(nextDir.x)!==Math.abs(dir.x) || Math.abs(nextDir.y)!==Math.abs(dir.y)){
      if(!(nextDir.x===-dir.x && nextDir.y===-dir.y)) dir=nextDir;
    }
    const h=snake[0]; let nx=h.x+dir.x, ny=h.y+dir.y;
    if(wrap){ nx=(nx+COLS)%COLS; ny=(ny+ROWS)%ROWS; } else { if(nx<0||ny<0||nx>=COLS||ny>=ROWS) return over(); }
    if(snake.some((s,i)=>i>0 && s.x===nx && s.y===ny)) return over();
    snake.unshift({x:nx,y:ny});
    if(nx===acorn.x&&ny===acorn.y){
      score++; scoreEl.textContent=score; if(score>best){best=score; localStorage.setItem('cerdo_best',best); bestEl.textContent=best;}
      grow++; fat=Math.min(fat+1,20); tick=Math.max(SPEED_MIN, tick-SPEED_STEP);
      acorn=free(snake); burst(nx,ny); oing();
    }
    if(grow>0) grow--; else snake.pop();
  }
  function over(){ running=false; paused=false; draw(true); }

  function draw(gameOver=false){
    drawBackground();
    // comida
    drawAcorn(acorn.x,acorn.y);
    // cerdito
    const extra = Math.min(fat*0.03, 0.6);
    snake.forEach((seg,i)=>{
      const scale = 1 + (i===0? extra : extra*0.7);
      drawPig(seg.x,seg.y,i===0, dir, scale);
    });
    drawParts();
    if(!running || gameOver){
      ctx.fillStyle='rgba(0,0,0,.55)';
      ctx.fillRect(0,0,cv.width,cv.height);
      ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.font='800 28px system-ui';
      ctx.fillText(gameOver?'üíÄ ¬°Has perdido, jamoncito!':'üê∑ Cerdo & Bellotas', cv.width/2, cv.height/2-10);
      ctx.font='600 16px system-ui'; ctx.fillText('Pulsa ‚ñ∂Ô∏è para reiniciar', cv.width/2, cv.height/2+22);
    }
  }

  // ===== Loop =====
  function loop(t){
    if(!running){ draw(); return; }
    if(paused){ draw(); requestAnimationFrame(loop); return; }
    if(!last) last=t; const dt=t-last; last=t; acc+=dt;
    while(acc>=tick){ step(); acc-=tick; } draw(); requestAnimationFrame(loop);
  }

  // ===== Controles =====
  addEventListener('keydown',e=>{
    const k=e.key.toLowerCase();
    if(k==='arrowup'||k==='w') nextDir={x:0,y:-1};
    else if(k==='arrowdown'||k==='s') nextDir={x:0,y:1};
    else if(k==='arrowleft'||k==='a') nextDir={x:-1,y:0};
    else if(k==='arrowright'||k==='d') nextDir={x:1,y:0};
    else if(k===' ') { reset(); requestAnimationFrame(loop); }
    else if(k==='p') setPause(!paused);
  });
  function tap(v){ nextDir=v; }
  ;[up,down,left,right].forEach(b=>b.addEventListener('touchstart',ev=>{ev.preventDefault(); b.click();},{passive:false}));
  up.onclick=()=>tap({x:0,y:-1}); down.onclick=()=>tap({x:0,y:1}); left.onclick=()=>tap({x:-1,y:0}); right.onclick=()=>tap({x:1,y:0});
  // swipe
  let t0=null; cv.addEventListener('touchstart',e=>{ if(!running) return; const t=e.changedTouches[0]; t0={x:t.clientX,y:t.clientY}; },{passive:true});
  cv.addEventListener('touchend',e=>{ if(!t0) return; const t=e.changedTouches[0], dx=t.clientX-t0.x, dy=t.clientY-t0.y; if(Math.max(Math.abs(dx),Math.abs(dy))>24){ if(Math.abs(dx)>Math.abs(dy)) nextDir={x:dx>0?1:-1,y:0}; else nextDir={x:0,y:dy>0?1:-1}; } t0=null; },{passive:true});

  // Botones UI
  playBtn.onclick=()=>{ ensureAudio(); reset(); requestAnimationFrame(loop); };
  pauseBtn.onclick=()=>{ if(running) setPause(!paused); };
  soundBtn.onclick=()=>{ audioOn=!audioOn; soundBtn.textContent=audioOn?'üîä Sonido':'üîá Silencio'; if(audioOn) ensureAudio(); };
  wrapBtn.onclick =()=>{ wrap=!wrap; wrapBtn.textContent=wrap?'üîÅ Wrap: ON':'‚õî Wrap: OFF'; };
  shareBtn.onclick=async()=>{
    const url=location.href, text='¬°Prueba mi juego Cerdo & Bellotas! üê∑üå∞';
    if(navigator.share){ try{await navigator.share({title:document.title,text,url});}catch(_){} }
    else { try{await navigator.clipboard.writeText(url); shareBtn.textContent='‚úÖ Copiado'; setTimeout(()=>shareBtn.textContent='üîó Compartir',1600);}catch(_){} }
  };

  // Init
  resize(); draw(false);
})();
</script>
</body>
</html>
